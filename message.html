<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Bryan Yuen Personal Profile</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <script src="https://www.gstatic.com/firebasejs/5.9.0/firebase.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <script>
        // Initialize Firebase
        var config = {
            apiKey: "AIzaSyCkW5kLw1F-WwodPwQTbNGwf77hLHhx30w",
            authDomain: "bryan-profile.firebaseapp.com",
            databaseURL: "https://bryan-profile.firebaseio.com",
            projectId: "bryan-profile",
            storageBucket: "bryan-profile.appspot.com",
            messagingSenderId: "3141904489"
        };
        firebase.initializeApp(config);

        firebase.auth().onAuthStateChanged(function(user) {
            if (user) {
                // User is signed in.
                alert("Welcome to the Message Board: " + user.email);
            } else {
                // No user is signed in.
                alert("Please Login to use the Message board");
                window.location.href = './login.html';
            }
        });
    </script>
</head>
<body>
<nav class="navbar navbar-expand-lg bg-dark navbar-dark">
    <div class="container">
        <a class="navbar-brand" href=index.html>Bryan Yuen</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#collapsibleNavbar">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse justify-content-end" id="collapsibleNavbar">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" href=aboutme.html>About Me</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href=projects.html>Projects</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href=interest.html>Interest</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href=recommend.html>Tech Channels</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href=message.html>Message Board</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href=contact.html>Contact Me</a>
                </li>
                <li class="btn btn-primary btn-sm" onclick="signOut()">
                    <a class="nav-link" href="#">Sign Out</a>
                </li>
            </ul>
        </div>
    </div>
</nav>
<br>
<div class="container col-10 justify-content-center bg-dark" id="msg">
    <br>
    <div id="accordion">
        <div class="card">
            <div class="card-header text-center" id="headingOne">
                <h5 class="mb-0">
                    <button class="btn btn-primary collapsed" data-toggle="collapse" data-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                        Send a Message
                    </button>
                </h5>
            </div>

            <div id="collapseOne" class="collapse" aria-labelledby="headingOne" data-parent="#accordion">
                <div class="container">
                    <br>
                    <form>
                        <div class="form-group">
                            <label for="msg_name">Name: </label>
                            <input type="text" class="form-control" id="msg_name" placeholder="Bryan">
                        </div>
                        <div class="form-group">
                            <label for="msg_body">Message: </label>
                            <textarea class="form-control" id="msg_body" rows="3"></textarea>
                        </div>
                        <button type="button" class="btn btn-primary" onclick="addmsg()">Send Message</button>
                        <br>
                    </form>
                    <br>
                </div>
            </div>
        </div>
    </div>
    <br>
</div>
<br>
<br>
<br>
<footer class="page-footer font-small bg-dark fixed-bottom">
    <div class="footer-copyright text-center text-light py-3">Â© 2019 Copyright : Bryan Yuen
    </div>
</footer>
<script>
    var db = firebase.firestore();
    function addmsg(){

        var msgname = document.getElementById("msg_name").value;
        var msg = document.getElementById("msg_body").value;

        db.collection("message_board").add({
            msg_name: msgname,
            msg_msg: msg,
        })
            .then(function(docRef) {
                console.log("Document written with ID: ", docRef.id);
            })
            .catch(function(error) {
                console.error("Error adding comment: ", error);
            });

        document.getElementById("msg_name").value = "";
        document.getElementById("msg_body").value = "";
        alert("Message Sent")
    }
    const collection = db.collection('message_board');
    collection.get().then(snapshot => {
        snapshot.forEach(doc => {
            var dbo = Object.assign({ uid: doc.id }, doc.data());
            var msg_n = dbo.msg_name;
            var msg_m = dbo.msg_msg;

            var div = document.createElement("div");

            div.innerHTML =
                '<div class="card text">\n' +
                '<div class="card-body text">\n' +
                '<h4 class="text container-fluid">\n' +
                'Name: ' + msg_n +'\n' +
                '</h4>\n' +
                '<div class="card-footer text-muted">\n' +
                'Message: ' + msg_m +
                '</div>'+
                '</div>\n' +
                '</div>\n' +
                '<br>';

            document.getElementById("msg").appendChild(div);
        });
    })
</script>
</body>
</html>