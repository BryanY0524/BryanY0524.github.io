<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Bryan Yuen Personal Profile</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <script src="https://www.gstatic.com/firebasejs/5.9.0/firebase.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

    <script>
        // Initialize Firebase
        var config = {
            apiKey: "AIzaSyCkW5kLw1F-WwodPwQTbNGwf77hLHhx30w",
            authDomain: "bryan-profile.firebaseapp.com",
            databaseURL: "https://bryan-profile.firebaseio.com",
            projectId: "bryan-profile",
            storageBucket: "bryan-profile.appspot.com",
            messagingSenderId: "3141904489"
        };
        firebase.initializeApp(config);

        var admin_list = [];
        var db = firebase.firestore();
        var docRef = db.collection("users");
        docRef.get().then(snapshot => {snapshot.forEach(doc =>{
            var dbo = Object.assign({uid: doc.id}, doc.data());
            var user_mail = dbo.email;
            admin_list.push(user_mail)
        })});

        function adminuser() {
            firebase.auth().onAuthStateChanged(function (user) {
                if (user) {
                    // User is signed in.
                    u_mail = user.email;
                    console.log(u_mail);
                    if (admin_list.includes(u_mail)) {
                        alert("You are Logged In as admin");
                    } else {
                        alert("You are not allowed here");
                        window.location.href = './index.html';
                    }
                } else {
                    // No user is signed in.
                    alert("You are not logged in");
                    window.location.href = './login.html';
                }
            });
        }
        setTimeout(adminuser,1800);

        function signOut(){
            firebase.auth().signOut().then(function() {
                alert("Signed out!");
                window.location.href = './index.html';
            }).catch(function(error) {
                // An error happened.
            });
        }
    </script>
</head>
<body>
<nav class="navbar navbar-expand-lg bg-dark navbar-dark">
    <a class="navbar-brand" href=./index.html>Bryan Yuen</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#collapsibleNavbar">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse justify-content-end" id="collapsibleNavbar">
        <ul class="navbar-nav">
            <li class="nav-item">
                <a class="nav-link" href=aboutme.html>About Me</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href=projects.html>Projects</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href=interest.html>Interest</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href=recommend.html>Tech Channels</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href=message.html>Message Board</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href=contact.html>Contact Me</a>
            </li>
            <li class="btn btn-primary btn-sm" onclick="signOut()">
                <a class="nav-link" href="#">Sign Out</a>
            </li>
        </ul>
    </div>
</nav>
<br>
<div class="container col-10 justify-content-center">
    <div id="accordion">
        <div class="card">
            <div class="card-header" id="headingfile">
                <h5 class="mb-0">
                    <button class="btn btn-link collapsed" data-toggle="collapse" data-target="#collapsefile" aria-expanded="false" aria-controls="collapsefile">
                        Upload Project File
                    </button>
                </h5>
            </div>
            <div id="collapsefile" class="collapse" aria-labelledby="headingfile" data-parent="#accordion">
                <br>
                <div class="container justify-content-center">
                    <progress value="0" max="100" id="uploader">0%</progress>
                    <input type="file" id="fileButton">
                </div>
                <br>
            </div>
        </div>
        <div class="card">
            <div class="card-header" id="headingOne">
                <h5 class="mb-0">
                    <button class="btn btn-link collapsed" data-toggle="collapse" data-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                        Update Project
                    </button>
                </h5>
            </div>

            <div id="collapseOne" class="collapse" aria-labelledby="headingOne" data-parent="#accordion">
                <div class="container">
                    <br>
                    <form>
                        <div class="form-group">
                            <label for="pro_name">Project Name</label>
                            <input type="text" class="form-control" id="pro_name" placeholder="Python - 123">
                        </div>
                        <div class="form-group">
                            <label for="pro_des">Project Description</label>
                            <textarea class="form-control" id="pro_des" rows="3"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="pro_f_path">File path</label>
                            <input type="text" class="form-control" id="pro_f_path" placeholder="pro_file/123.pdf or direct link from firebase">
                        </div>
                        <button type="button" class="btn btn-primary" onclick="addpro()">Upload</button>
                        <br>
                    </form>
                    <br>
                </div>
            </div>
        </div>
        <div class="card">
            <div class="card-header" id="headingTwo">
                <h5 class="mb-0">
                    <button class="btn btn-link collapsed" data-toggle="collapse" data-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                        Update Tech Channels
                    </button>
                </h5>
            </div>
            <div id="collapseTwo" class="collapse" aria-labelledby="headingTwo" data-parent="#accordion">
                <div class="container">
                    <br>
                    <form>
                        <div class="form-group">
                            <label for="tc_name">Channel Name</label>
                            <input type="text" class="form-control" id="tc_name" placeholder="Linus Tech Tips">
                        </div>
                        <div class="form-group">
                            <label for="tc_des">Channel Description</label>
                            <textarea class="form-control" id="tc_des" rows="3"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="tc_url">Channel Youtube URL</label>
                            <input type="text" class="form-control" id="tc_url" placeholder="http://www.youtube.com/embed/...">
                        </div>
                        <button type="button" class="btn btn-primary" onclick="addtc()">Upload</button>
                        <br>
                    </form>
                    <br>
                </div>
            </div>
        </div>
    </div>
</div>
<footer class="page-footer font-small bg-dark fixed-bottom">
    <div class="footer-copyright text-center text-light py-3">Â© 2019 Copyright : Bryan Yuen
    </div>
</footer>
<script>
    fileButton.addEventListener('change', function(e){
        //get the file
        alert("uploading file...");
        var file = e.target.files[0];
        //create the storage ref
        var storageRef = firebase.storage().ref('pro_file/'+file.name);
        //uplaod the file
        var task = storageRef.put(file);
        //update the progress bar

        task.on('state_changed',
            function progress(snapshot) {
                var percentage = (snapshot.bytesTransferred/snapshot.totalBytes)*100;
                uploader.value = percentage;
            },
            function error(err){
                console.log(err);
            },
            function complete(){
                alert("upload complete");
            }
        );
    });
    var db = firebase.firestore();

    function addpro(){

        var pname = document.getElementById("pro_name").value;
        var pdes = document.getElementById("pro_des").value;
        var p_f_p = document.getElementById("pro_f_path").value;

        db.collection("projects").add({
            pro_name: pname,
            pro_detail: pdes,
            pro_file_path: p_f_p,
        })
            .then(function(docRef) {
                console.log("Document written with ID: ", docRef.id);
            })
            .catch(function(error) {
                console.error("Error adding comment: ", error);
            });
        document.getElementById('pro_name').value = "";
        document.getElementById('pro_des').value = "";
        document.getElementById('pro_f_path').value = "";
        alert("Project Added")
    }

    function addtc(){

        var tcname = document.getElementById("tc_name").value;
        var tcdes = document.getElementById("tc_des").value;
        var tclink = document.getElementById("tc_url").value;

        db.collection("tc").add({
            tc_name: tcname,
            tc_des: tcdes,
            tc_link: tclink,
        })
            .then(function(docRef) {
                console.log("Document written with ID: ", docRef.id);
            })
            .catch(function(error) {
                console.error("Error adding comment: ", error);
            });

        document.getElementById('tc_name').value = "";
        document.getElementById('tc_des').value = "";
        document.getElementById('tc_url').value = "";
        alert("Tech Channel Added")
    }
</script>
</body>
</html>

